<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>IoT传感器数据监控系统 - 武汉大学计算机学院</title>
    <!-- 引入原有CSS -->
    <link rel="stylesheet" href="{{ url_for('static', filename='css/style.css') }}">
    <!-- 确保Chart.js正确加载 -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

    <!-- 【新增】内联样式，为了实现封面和转场效果 -->
    <!-- 建议后期将这部分移动到 style.css 中 -->
</head>
<body>
    <!-- ========================================== -->
    <!-- ========================================== -->
    <!-- 第一部分：增强版滚动封面页 (Landing Page) -->
    <!-- ========================================== -->
    <div id="landingPage" class="landing-scroll-container">

        <!-- 1. 顶部固定导航栏 -->
        <nav class="landing-nav glass-effect">
            <div class="nav-brand">
                <span class="nav-logo">🚩 2026武汉大学计算机学院“E乡情”寒假社会实践</span>
            </div>
            <div class="nav-links">
                <a href="#hero">首页</a>
                <a href="#about-school">院校风采</a>
                <a href="#about-team">实践团队</a>
                <button class="nav-btn-enter" onclick="enterSystem()">进入系统</button>
            </div>
        </nav>

        <!-- 背景层 (固定不动) -->
        <div class="landing-fixed-bg"></div>

        <!-- 2. 内容滚动区域 -->
        <div class="scroll-content">

            <!-- SECTION 1: 首屏 (Hero) -->
            <section id="hero" class="full-screen-section">
                <div class="hero-card glass-effect animate-up">
                    <div class="logos-area">
                        <div class="logo-item">🏛️ 武汉大学</div>
                        <div class="divider-vertical"></div>
                        <div class="logo-item">💻 计算机学院“E乡情”社会实践队</div>
                    </div>

                    <div class="hero-badge">2026年寒假社会实践成果</div>

                    <h1 class="hero-title">智慧农业 · IoT环境监测系统</h1>
                    <p class="hero-subtitle">
                        基于 <strong>Flask + MQTT + Edge Computing</strong> 的精准农业解决方案。<br>
                        解决传统农业数据采集难、实时性差痛点，助力乡村振兴。
                    </p>

                    <div class="scroll-hint">
                        <p>👇 向下滚动探索团队风采</p>
                        <div class="arrow-down"></div>
                    </div>
                </div>
            </section>

            <!-- SECTION 2: 学校与学院介绍 -->
            <section id="about-school" class="info-section">
                <div class="section-container">
                     <h2 class="section-title">🏫 珞珈山下的学术殿堂</h2>

                     <div class="school-grid">

                        <!-- 卡片 1：武汉大学 -->
                        <div class="info-card school-card glass-effect">
                            <!-- 徽标区域 -->
                            <div class="logo-wrapper">
                                <!-- 请确保 static/images/whu_logo.png 存在 -->
                                <img src="{{ url_for('static', filename='logos/whu_logo.png') }}" alt="武汉大学校徽">
                            </div>

                            <!-- 荣誉标签 -->
                            <div class="school-badges">
                                <span class="badge-tag">985工程</span>
                                <span class="badge-tag">211工程</span>
                                <span class="badge-tag">双一流建设高校</span>
                                <span class="badge-tag">教育部直属</span>
                            </div>

                            <!-- 详细介绍 -->
                            <p class="school-desc-text">
                                环绕东湖水，坐拥珞珈山。武汉大学溯源于1893年清末湖广总督张之洞创办的自强学堂，近代中国第一批国立大学。校园环境优美，中西合璧的宫殿式建筑群古朴典雅，被誉为“中国最美丽的大学”之一。
                            </p>

                            <!-- 校训 -->
                            <div class="school-motto">自强、弘毅、求是、拓新</div>
                        </div>

                        <!-- 卡片 2：计算机学院 -->
                        <div class="info-card school-card glass-effect">
                            <!-- 徽标区域 -->
                            <div class="logo-wrapper">
                                <!-- 请确保 static/images/cs_logo.png 存在 -->
                                <img src="{{ url_for('static', filename='logos/cs_logo.png') }}" alt="计算机学院院徽">
                            </div>

                            <!-- 荣誉标签 -->
                            <div class="school-badges">
                                <span class="badge-tag">拥A+学科</span>
                                <span class="badge-tag">拥国家特色专业</span>
                                <span class="badge-tag">卓越工程师计划</span>
                            </div>

                            <!-- 详细介绍 -->
                            <p class="school-desc-text">
                                武汉大学计算机学院是全国最早建立的计算机科学院系之一。学院实力雄厚，拥有多媒体软件工程技术研究中心等国家级科研平台。在人工智能、物联网、软件工程等领域处于国内领先水平，致力于培养复合型高层次人才。
                            </p>

                            <!-- 实践支持 -->
                            <div class="school-motto" style="font-size: 0.95rem; color: #a7f3d0;">
                                依托物联网工程实验室技术支持
                            </div>
                        </div>

                    </div>
                </div>
            </section>

            <!-- SECTION 3: 【重点修改】团队与风采展示 -->
            <section id="about-team" class="info-section">
                <div class="section-container wide-container"> <!-- 增加 wide-container 类 -->
                    <h2 class="section-title">👥 “E乡情”实践团队</h2>

                    <!-- 文字介绍 -->
                    <!-- 文字介绍与分组展示 -->
                    <div class="team-intro glass-effect">
                        <h3>项目背景与分工</h3>
                        <p class="team-desc">
                            我们是来自武汉大学计算机学院的社会实践队伍。本项目旨在将计算机视觉与物联网技术应用于田间地头，通过低成本硬件实现环境数据的实时采集与分析。
                        </p>

                        <!-- 分组信息 Grid 布局 -->
                        <div class="team-groups-grid">

                            <!-- 技术组 -->
                            <div class="group-card group-tech">
                                <h4><span>💻</span> 技术组</h4>
                                <div class="group-content">
                                    <div class="role-block">
                                        <span class="role-title">主负责人</span>
                                        <strong class="role-name">刘炎轩</strong>
                                    </div>
                                    <div class="role-block">
                                        <span class="role-title">成员</span>
                                        <span class="member-list">高亦菲, 周可泽, 刘睿, 高锦松</span>
                                    </div>
                                </div>
                            </div>

                            <!-- 宣传组 -->
                            <div class="group-card group-publicity">
                                <h4><span>📸</span> 宣传组</h4>
                                <div class="group-content">
                                    <div class="role-block">
                                        <span class="role-title">主负责人</span>
                                        <strong class="role-name">王依霖</strong>
                                    </div>
                                    <div class="role-block">
                                        <span class="role-title">成员</span>
                                        <span class="member-list">张一鸣, 苏梓凯, 孙艺蕾, 殷嘉忆</span>
                                    </div>
                                </div>
                            </div>

                            <!-- 宣讲组 -->
                            <div class="group-card group-presentation">
                                <h4><span>🎤</span> 宣讲组</h4>
                                <div class="group-content">
                                    <div class="role-block">
                                        <span class="role-title">主负责人</span>
                                        <strong class="role-name">高一鸣</strong>
                                    </div>
                                    <div class="role-block">
                                        <span class="role-title">成员</span>
                                        <span class="member-list">董文卓, 马友会, 彭乔茜</span>
                                    </div>
                                </div>
                            </div>

                        </div>
                    </div>

                    <!-- === 媒体展示区域 === -->
                    <h3 style="color:white; margin-bottom: 20px; border-left: 4px solid #48bb78; padding-left: 10px;">📸 实践风采</h3>

                    <!-- 1. 上半部分：流动相册 (代码保持不变，逻辑是占满整行) -->
                    <div class="flowing-gallery-container">
                        <div class="gallery-track">

                            <!-- 第一轮循环 -->
                            {% for photo in photos %}
                            <div class="gallery-card glass-effect">
                                <div class="card-image-box">
                                    <img src="{{ url_for('static', filename='photos/' + photo) }}" alt="实践照片">
                                </div>
                            </div>
                            {% endfor %}

                            <!-- 第二轮循环 (用于无缝滚动) -->
                            {% if photos %}
                                {% for photo in photos %}
                                <div class="gallery-card glass-effect">
                                    <div class="card-image-box">
                                        <img src="{{ url_for('static', filename='photos/' + photo) }}" alt="实践照片">
                                    </div>
                                </div>
                                {% endfor %}
                            {% else %}
                                <div class="gallery-card glass-effect">
                                    <div class="caption">暂无照片</div>
                                </div>
                            {% endif %}

                        </div>
                    </div>

                    <!-- 2. 下半部分：视频展示 (独立出来，放在下方) -->
                    <div class="video-section-wrapper">
                        <!-- 视频卡片 -->
                        <div class="media-item video-slot glass-effect">
                            <div class="placeholder-content">
                                <!-- 这里可以放你的 <video> 标签 -->
                                <!-- 暂时使用占位符 -->
                                <div class="placeholder-text">
                                    <span>🎥</span><br>在此处插入实践纪录片/Demo视频
                                </div>
                            </div>
                            <div class="caption" style="font-size: 1.1rem; margin-top: 15px;">项目成果演示视频</div>
                            </div>
                        </div>
                    </div>
            </section>
                    <!-- === 替换结束 === -->

            <!-- SECTION 4: 进入系统入口 -->
            <section id="entry-point" class="full-screen-section" style="min-height: 60vh;">
                <div class="hero-card glass-effect">
                    <!-- 标题修改：更正式 -->
                    <h2 style="font-size: 2.2rem; margin-bottom: 20px; letter-spacing: 1px;">
                        IoT 环境监测数据可视化平台
                    </h2>

                    <!-- 副标题修改：强调技术实现和功能 -->
                    <p style="margin-bottom: 40px; color: rgba(255,255,255,0.85); font-size: 1.1rem; max-width: 600px; margin-left: auto; margin-right: auto; line-height: 1.8;">
                        基于物联网与多源传感技术，实现对目标区域的全天候精准感知。<br>
                        点击下方按钮，即可接入数据中心，查看实时环境指标与分析图表。
                    </p>

                    <!-- 按钮文字微调 -->
                    <button class="main-cta-btn big-pulse" onclick="enterSystem()">
                        🚀 进入监控控制台
                    </button>
                </div>
            </section>

            <!-- 底部版权 -->
            <footer class="landing-footer">
                <p>&copy; 2026 武汉大学计算机学院“E乡情”社会实践队</p>
            </footer>
        </div>
    </div>

    <!-- ========================================== -->
    <!-- 第二部分：数据监控系统 (原代码包裹在这里) -->
    <!-- ========================================== -->
    <div id="mainDashboard" class="dashboard-container">
        <!-- 原有的 .container -->
        <div class="container">
            <!-- 在 mainDashboard 内部找到 header -->
            <div class="header">
                <div style="display: flex; align-items: center; gap: 20px;">
                    <!-- 新增：返回按钮 -->
                    <button class="back-btn" onclick="exitSystem()">
                        ⬅ 返回首页
                    </button>
                    <div>
                        <h1>🌱 IoT传感器数据监控系统</h1>
                        <p>实时监控农业环境传感器数据</p>
                    </div>
                </div>

                <div class="status-badge" id="systemStatus">
                    系统运行中
                </div>
            </div>

            <div class="grid">
                <!-- 系统概览卡片 -->
                <div class="card">
                    <h2><i>📊</i> 系统概览</h2>
                    <div id="systemOverview">
                        <div class="stat-item">
                            <span class="stat-label">在线设备</span>
                            <span class="stat-value" id="onlineDevices">0</span>
                        </div>
                        <div class="stat-item">
                            <span class="stat-label">今日数据量</span>
                            <span class="stat-value" id="todayData">0</span>
                        </div>
                        <div class="stat-item">
                            <span class="stat-label">系统运行</span>
                            <span class="stat-value" id="uptime" data-uptime-seconds="0">计算中...</span>
                        </div>
                    </div>
                </div>

                <!-- 环境数据卡片 -->
                <div class="card">
                    <h2><i>🌡️</i> 环境数据</h2>
                    <div id="environmentData">
                        <div class="stat-item">
                            <span class="stat-label">温度</span>
                            <span class="stat-value" id="temperature">-- °C</span>
                        </div>
                        <div class="stat-item">
                            <span class="stat-label">湿度</span>
                            <span class="stat-value" id="humidity">-- %</span>
                        </div>
                        <div class="stat-item">
                            <span class="stat-label">PM2.5</span>
                            <span class="stat-value" id="pm25">-- μg/m³</span>
                        </div>
                        <div class="stat-item">
                            <span class="stat-label">光照</span>
                            <span class="stat-value" id="light">-- lux</span>
                        </div>
                    </div>
                </div>

                <!-- 通信状态卡片 -->
                <div class="card">
                    <h2><i>📡</i> 通信状态</h2>
                    <div id="communicationStatus">
                        <div class="stat-item">
                            <span class="stat-label">MQTT连接</span>
                            <span class="stat-value" id="mqttStatus">离线</span>
                        </div>
                        <div class="stat-item">
                            <span class="stat-label">数据完整性</span>
                            <span class="stat-value" id="dataIntegrity">-- %</span>
                        </div>
                        <div class="stat-item">
                            <span class="stat-label">数据质量</span>
                            <span class="stat-value" id="dataQuality">-- %</span>
                        </div>
                    </div>
                </div>
            </div>

            <!-- 温度趋势图表 -->
            <div class="card">
                <div class="card-header" style="display: flex; justify-content: space-between; align-items: center;">
                    <h2><i>📈</i> 温度趋势</h2>
                    <div class="time-selector">
                        <select id="tempTimeRange" class="time-select-btn" onchange="handleTimeChange('temp')">
                            <option value="1">最近 1 小时</option>
                            <option value="4">最近 4 小时</option>
                            <option value="24">最近 1 天</option>
                            <option value="168">最近 1 周</option>
                            <option value="720">最近 1 月</option>
                        </select>
                        <div id="tempChartInfo" style="font-size: 12px; color: #718096; margin-top: 5px; text-align: right;">
                            加载中...
                        </div>
                    </div>
                </div>
                <div class="chart-container">
                    <!-- 添加一个id用于调试 -->
                    <canvas id="temperatureChart" style="width: 100%; height: 300px;"></canvas>
                    <!-- 添加一个调试信息区域 -->
                    <div id="chartDebug" style="font-size: 10px; color: #999; margin-top: 5px; text-align: center;">
                        图表状态: 初始化中...
                    </div>
                </div>
            </div>

            <!-- 湿度趋势图表 -->
            <div class="card">
                <div class="card-header" style="display: flex; justify-content: space-between; align-items: center;">
                    <h2><i>💧</i> 湿度趋势</h2>
                    <div class="time-selector">
                        <select id="humTimeRange" class="time-select-btn" onchange="handleTimeChange('hum')">
                            <option value="1">最近 1 小时</option>
                            <option value="4">最近 4 小时</option>
                            <option value="24">最近 1 天</option>
                            <option value="168">最近 1 周</option>
                            <option value="720">最近 1 月</option>
                        </select>
                        <div id="humChartInfo" style="font-size: 12px; color: #718096; margin-top: 5px; text-align: right;">
                            加载中...
                        </div>
                    </div>
                </div>
                <div class="chart-container">
                    <canvas id="humidityChart" style="width: 100%; height: 300px;"></canvas>
                    <div id="humidityChartDebug" style="font-size: 10px; color: #999; margin-top: 5px; text-align: center;">
                        图表状态: 初始化中...
                    </div>
                </div>
            </div>

            <!-- 最新数据表格 -->
            <div class="card">
                <h2><i>📋</i> 最新数据</h2>
                <table class="data-table" id="latestData">
                    <thead>
                        <tr>
                            <th>时间</th>
                            <th>设备</th>
                            <th>温度(°C)</th>
                            <th>湿度(%)</th>
                            <th>PM2.5</th>
                            <th>光照(lux)</th>
                        </tr>
                    </thead>
                    <tbody id="dataTableBody">
                        <!-- 数据将通过JavaScript填充 -->
                    </tbody>
                </table>
            </div>

            <!-- API接口信息 -->
            <div class="card">
                <h2><i>🔌</i> 开发者接口</h2>
                <div class="api-info">
                    <p style="color: #718096; margin-bottom: 15px; font-size: 0.9rem;">
                        本系统提供标准的 RESTful API，支持第三方数据接入与二次开发。
                    </p>

                    <div class="api-list">
                        <!-- 接口 1 -->
                        <div class="api-endpoint-item">
                            <span class="method-badge get">GET</span>
                            <code class="api-url">/api/devices</code>
                            <span class="api-desc">获取所有在线设备列表</span>
                        </div>

                        <!-- 接口 2 -->
                        <div class="api-endpoint-item">
                            <span class="method-badge get">GET</span>
                            <code class="api-url">/api/data/latest?device_id={id}</code>
                            <span class="api-desc">获取指定设备最新数据</span>
                        </div>

                        <!-- 接口 3 -->
                        <div class="api-endpoint-item">
                            <span class="method-badge get">GET</span>
                            <code class="api-url">/api/data/history?device_id={id}</code>
                            <span class="api-desc">获取设备历史趋势数据</span>
                        </div>

                         <!-- 接口 4 -->
                        <div class="api-endpoint-item">
                            <span class="method-badge get">GET</span>
                            <code class="api-url">/api/system/status</code>
                            <span class="api-desc">获取服务器运行状态</span>
                        </div>
                    </div>
                </div>
            </div>

            <!-- 刷新按钮 -->
            <button class="refresh-btn" onclick="refreshData()">
                🔄 刷新数据
            </button>
        </div>
    </div>
    <!-- End of Dashboard Container -->

    <!-- JS引用保持不变 -->
    <script>
        console.log("开始加载main.js...");
    </script>
    <script src="{{ url_for('static', filename='js/main.js') }}"></script>
    <script>
        console.log("main.js加载完成");

        // === 新增：处理页面进入逻辑的脚本 ===
        function enterSystem() {
            const landing = document.getElementById('landingPage');
            const dashboard = document.getElementById('mainDashboard');

            // 1. 封面向上滑走
            landing.classList.add('hidden');

            // 2. 仪表盘取消模糊，变为活跃状态
            dashboard.classList.add('active');

            // 3. 延迟一小会儿触发数据刷新，确保图表渲染在可见区域
            setTimeout(() => {
                if (typeof refreshData === 'function') {
                    console.log("Entering system, refreshing data...");
                    refreshData();
                }
            }, 800);
        }

        function exitSystem() {
            const landing = document.getElementById('landingPage');
            const dashboard = document.getElementById('mainDashboard');

            // 1. 仪表盘隐藏
            dashboard.classList.remove('active');

            // 2. 封面页滑下来（移除 hidden 类）
            landing.classList.remove('hidden');

            landing.scrollTop = 0;
        }
    </script>
</body>
</html>
